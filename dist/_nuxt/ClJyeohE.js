import{_ as Y}from"./spp0zfZc.js";import{g as Z,n as f,r,y as T,z as W,A as ee,c,a as o,k as $,b as q,w as A,l as F,v as V,F as _,q as M,t as C,B as te,o as i,C as oe,D as se,d as ae}from"./a-2ymmio.js";import{a as b}from"./BtuGy7By.js";import"./BbCOxZKf.js";import"./_d1bhYXs.js";const ne={class:"CategoriesBody"},le={class:"vertical-container"},re={class:"button-container"},ce={class:"search-container"},ie={class:"CategoriesCenter"},de={class:"Categories",id:"section1"},ue=["onClick","onMouseover"],ve={style:{"text-decoration":"none",color:"black"}},pe={key:0,class:"modal-overlay-addCategory"},me={class:"modal-content-addCategory"},ge={key:1,class:"modal-overlay-deleteCategory"},ye={class:"modal-content-deleteCategory"},he={key:0},fe={class:"slider"},_e={class:"slides"},Ce={class:"container"},be={class:"ProductPreview"},we=["src"],ke={class:"ProductName"},xe={class:"Price"},Pe={class:"ProductButton"},Se={class:"navigation"},$e=["value","max"],Le=Z({__name:"index",setup(qe){const U=e=>new Intl.NumberFormat("ru-RU",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(e).replace(/\s/g,".");f(async()=>{try{const e=await b.get("http://localhost:5000/api/admins/check-auth",{withCredentials:!0});console.log("Ответ от сервера при проверке авторизации",e.data),(!e.data.success||e.data.role!=="sAdmin")&&(window.location.href="/admin")}catch(e){console.error("Ошибка при проверке авторизации",e),window.location.href="/admin"}});const a=r(0),d=r(15),p=r([]),h=r(""),w=()=>{const e=window.innerWidth;e<=1023?d.value=6:e<=1279?d.value=9:e<=1539?d.value=12:d.value=15};f(()=>{w(),window.addEventListener("resize",w)}),T(()=>{window.removeEventListener("resize",w)}),W(d,()=>{g()});const D=async()=>{try{const e=await b.get("http://localhost:5000/api/products");p.value=e.data,console.log("Все товары загружены:",p.value),g()}catch(e){console.error("Ошибка при загрузке всех товаров:",e)}},X=async()=>{try{const e=await b.get(`http://localhost:5000/api/products/search/${h.value}`);p.value=e.data,a.value=0,g()}catch(e){console.error("Ошибка при поиске товаров:",e)}};W(h,e=>{e.trim()===""?D():X()});const m=ee(()=>Math.ceil(p.value.length/d.value)),j=e=>{const t=e*d.value,n=t+d.value;return p.value.slice(t,n)},g=()=>{document.querySelectorAll(".page").forEach((t,n)=>{n===a.value?t.classList.add("active"):t.classList.remove("active")}),K(),O()},K=()=>{const e=document.querySelector(".nav-btn.prev"),t=document.querySelector(".nav-btn.next");e&&t&&(a.value===0?(e.disabled=!0,e.style.backgroundColor="gray"):(e.disabled=!1,e.style.backgroundColor="red"),a.value===m.value-1?(t.disabled=!0,t.style.backgroundColor="gray"):(t.disabled=!1,t.style.backgroundColor="red"))},O=()=>{const e=document.querySelector(".page-input");e&&(e.value=(a.value+1).toString(),e.style.backgroundColor="")},N=()=>{const e=document.querySelector(".page-input");if(e){const t=parseInt(e.value,10)-1;if(t>=0&&t<m.value){const n=document.querySelector(".slides"),l=document.querySelectorAll(".page")[0].clientWidth,v=Math.abs(a.value-t),H=Math.min(.5+v*.2,3);n.style.transition=`transform ${H}s ease-in-out`,a.value=t,n.style.transform=`translateX(-${a.value*l}px)`,g()}else e.style.backgroundColor="#ffcccc"}},B=()=>{const e=document.querySelector(".slides"),n=document.querySelectorAll(".page")[0].clientWidth;e.style.transition="none",e.style.transform=`translateX(-${a.value*n}px)`,setTimeout(()=>{e.style.transition=""},0)},L=e=>{const t=document.querySelector(".slides"),s=document.querySelectorAll(".page")[0].clientWidth;e==="prev"&&a.value>0?a.value-=1:e==="next"&&a.value<m.value-1&&(a.value+=1),t.style.transform=`translateX(-${a.value*s}px)`,g()};f(()=>{D(),window.addEventListener("resize",B)}),T(()=>{window.removeEventListener("resize",B)});const k=r(!1),x=r(!1),y=r(""),E=r([]),u=r(null),P=r(null),S=async()=>{try{const t=await(await fetch("http://localhost:5000/api/categories")).json();E.value=t}catch(e){console.error("Ошибка при получении категорий:",e)}},R=async()=>{if(!y.value.trim()){alert("Пожалуйста, введите название категории.");return}try{(await fetch("http://localhost:5000/api/categories",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({"categories-name":y.value.trim()})})).ok?(await S(),z()):alert("Ошибка при добавлении категории")}catch(e){console.error("Ошибка при добавлении категории:",e)}},J=async()=>{if(u.value)try{(await fetch(`http://localhost:5000/api/categories/${u.value._id}`,{method:"DELETE"})).ok?(await S(),I()):alert("Ошибка при удалении категории")}catch(e){console.error("Ошибка при удалении категории:",e)}},Q=(e,t)=>{e["categories-name"]!=="Все"&&(u.value=e,x.value=!0)},z=()=>{k.value=!1,y.value=""},I=()=>{x.value=!1,u.value=null};f(()=>{S()});const G=async()=>{try{await b.post("http://localhost:5000/api/admins/logout",{},{withCredentials:!0}),window.location.href="/admin"}catch(e){console.error("Ошибка при выходе из системы",e)}};return(e,t)=>{const n=Y;return i(),c(_,null,[o("button",{onClick:G,class:"logout-class"},"Выйти"),o("div",ne,[o("div",le,[o("div",re,[q(n,{to:"/admin/sAdmin/admin-product"},{default:A(()=>t[6]||(t[6]=[o("button",{class:"add-button"},"Добавить товар",-1)])),_:1}),o("button",{class:"add-button",onClick:t[0]||(t[0]=s=>k.value=!0)},"Добавить категорию")]),o("div",ce,[F(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>h.value=s),type:"text",placeholder:"Поиск товаров...",class:"search-input search-sAdmin"},null,512),[[V,h.value]])]),o("div",ie,[o("div",de,[(i(!0),c(_,null,M(E.value,(s,l)=>(i(),c("div",{class:"Сategory",key:l,onClick:v=>Q(s),onMouseover:v=>P.value=l,onMouseleave:t[2]||(t[2]=v=>P.value=null),style:oe({border:P.value===l&&s["categories-name"]!=="Все"?"2px solid red":"none"})},[o("a",ve,C(s["categories-name"]),1)],44,ue))),128))])])]),k.value?(i(),c("div",pe,[o("div",me,[t[7]||(t[7]=o("h3",null,"Введите название категории:",-1)),F(o("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>y.value=s),type:"text",placeholder:"Название категории",class:"modal-input-addCategory"},null,512),[[V,y.value]]),o("div",{class:"modal-buttons-addCategory"},[o("button",{class:"modal-button-addCategory add",onClick:R},"Добавить"),o("button",{class:"modal-button-addCategory cancel",onClick:z},"Отмена")])])])):$("",!0),x.value?(i(),c("div",ge,[o("div",ye,[u.value?(i(),c("h3",he,'Вы действительно хотите удалить категорию: "'+C(u.value["categories-name"])+'"?',1)):$("",!0),o("div",{class:"modal-buttons-deleteCategory"},[o("button",{class:"modal-button-deleteCategory delete",onClick:J},"Удалить"),o("button",{class:"modal-button-deleteCategory cancel",onClick:I},"Отмена")])])])):$("",!0)]),o("div",fe,[o("div",_e,[(i(!0),c(_,null,M(m.value,s=>(i(),c("div",{key:s,class:se(["page",{active:a.value===s-1}])},[o("div",Ce,[(i(!0),c(_,null,M(j(s-1),(l,v)=>(i(),c("div",{class:"item",key:v},[o("div",be,[q(n,{to:`/admin/sAdmin/admin-product/${l._id}`},{default:A(()=>[o("img",{src:l["product-image"],style:{width:"100%",height:"100%"}},null,8,we)]),_:2},1032,["to"])]),o("div",ke,C(l["product-name"]),1),o("div",xe,[ae(C(U(l["product-price"]))+" р",1),t[8]||(t[8]=o("p",{class:"quantity"},"/1шт",-1))]),o("div",Pe,[q(n,{to:`/admin/sAdmin/admin-product/${l._id}`},{default:A(()=>t[9]||(t[9]=[o("button",{class:"ProductBtn"},"Изменить товар",-1)])),_:2},1032,["to"])])]))),128))])],2))),128))]),o("div",Se,[o("button",{class:"nav-btn prev",onClick:t[4]||(t[4]=s=>L("prev"))},"<"),o("input",{class:"page-input",type:"number",value:a.value+1,onInput:N,onKeyup:te(N,["enter"]),min:"1",max:m.value},null,40,$e),o("button",{class:"nav-btn next",onClick:t[5]||(t[5]=s=>L("next"))},">")])])],64)}}});export{Le as default};
