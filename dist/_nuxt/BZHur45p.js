import{_ as Z}from"./VLZ1h-JR.js";import{g as ee,j as te,p as _,r,z as W,A as F,B as oe,c as i,a as o,l as A,b as M,w as q,m as V,v as U,F as C,s as D,t as b,C as se,o as c,D as ae,E as ne,d as le}from"./CtCbi2K0.js";import{a as w}from"./BtuGy7By.js";import"./BbCOxZKf.js";import"./_d1bhYXs.js";const re={class:"CategoriesBody"},ie={class:"vertical-container"},ce={class:"button-container"},de={class:"search-container"},ue={class:"CategoriesCenter"},ve={class:"Categories",id:"section1"},pe=["onClick","onMouseover"],me={style:{"text-decoration":"none",color:"black"}},ge={key:0,class:"modal-overlay-addCategory"},ye={class:"modal-content-addCategory"},he={key:1,class:"modal-overlay-deleteCategory"},fe={class:"modal-content-deleteCategory"},_e={key:0},Ce={class:"slider"},be={class:"slides"},we={class:"container"},ke={class:"ProductPreview"},xe=["src"],Pe={class:"ProductName"},$e={class:"Price"},Se={class:"ProductButton"},Ae={class:"navigation"},Me=["value","max"],ze=ee({__name:"index",setup(qe){const{public:{apiBaseUrl:u}}=te(),j=e=>new Intl.NumberFormat("ru-RU",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(e).replace(/\s/g,".");_(async()=>{try{const e=await w.get(`${u}/api/admins/check-auth`,{withCredentials:!0});console.log("Ответ от сервера при проверке авторизации",e.data),(!e.data.success||e.data.role!=="sAdmin")&&(window.location.href="/admin")}catch(e){console.error("Ошибка при проверке авторизации",e),window.location.href="/admin"}});const a=r(0),d=r(15),m=r([]),f=r(""),k=()=>{const e=window.innerWidth;e<=1023?d.value=6:e<=1279?d.value=9:e<=1539?d.value=12:d.value=15};_(()=>{k(),window.addEventListener("resize",k)}),W(()=>{window.removeEventListener("resize",k)}),F(d,()=>{y()});const B=async()=>{try{const e=await w.get(`${u}/api/products`);m.value=e.data,console.log("Все товары загружены:",m.value),y()}catch(e){console.error("Ошибка при загрузке всех товаров:",e)}},R=async()=>{try{const e=await w.get(`${u}/api/products/search/${f.value}`);m.value=e.data,a.value=0,y()}catch(e){console.error("Ошибка при поиске товаров:",e)}};F(f,e=>{e.trim()===""?B():R()});const g=oe(()=>Math.ceil(m.value.length/d.value)),X=e=>{const t=e*d.value,n=t+d.value;return m.value.slice(t,n)},y=()=>{document.querySelectorAll(".page").forEach((t,n)=>{n===a.value?t.classList.add("active"):t.classList.remove("active")}),K(),O()},K=()=>{const e=document.querySelector(".nav-btn.prev"),t=document.querySelector(".nav-btn.next");e&&t&&(a.value===0?(e.disabled=!0,e.style.backgroundColor="gray"):(e.disabled=!1,e.style.backgroundColor="red"),a.value===g.value-1?(t.disabled=!0,t.style.backgroundColor="gray"):(t.disabled=!1,t.style.backgroundColor="red"))},O=()=>{const e=document.querySelector(".page-input");e&&(e.value=(a.value+1).toString(),e.style.backgroundColor="")},N=()=>{const e=document.querySelector(".page-input");if(e){const t=parseInt(e.value,10)-1;if(t>=0&&t<g.value){const n=document.querySelector(".slides"),l=document.querySelectorAll(".page")[0].clientWidth,p=Math.abs(a.value-t),Y=Math.min(.5+p*.2,3);n.style.transition=`transform ${Y}s ease-in-out`,a.value=t,n.style.transform=`translateX(-${a.value*l}px)`,y()}else e.style.backgroundColor="#ffcccc"}},E=()=>{const e=document.querySelector(".slides"),n=document.querySelectorAll(".page")[0].clientWidth;e.style.transition="none",e.style.transform=`translateX(-${a.value*n}px)`,setTimeout(()=>{e.style.transition=""},0)},L=e=>{const t=document.querySelector(".slides"),s=document.querySelectorAll(".page")[0].clientWidth;e==="prev"&&a.value>0?a.value-=1:e==="next"&&a.value<g.value-1&&(a.value+=1),t.style.transform=`translateX(-${a.value*s}px)`,y()};_(()=>{B(),window.addEventListener("resize",E)}),W(()=>{window.removeEventListener("resize",E)});const x=r(!1),P=r(!1),h=r(""),z=r([]),v=r(null),$=r(null),S=async()=>{try{const t=await(await fetch(`${u}/api/categories`)).json();z.value=t}catch(e){console.error("Ошибка при получении категорий:",e)}},J=async()=>{if(!h.value.trim()){alert("Пожалуйста, введите название категории.");return}try{(await fetch(`${u}/api/categories`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({"categories-name":h.value.trim()})})).ok?(await S(),I()):alert("Ошибка при добавлении категории")}catch(e){console.error("Ошибка при добавлении категории:",e)}},Q=async()=>{if(v.value)try{(await fetch(`${u}/api/categories/${v.value._id}`,{method:"DELETE"})).ok?(await S(),T()):alert("Ошибка при удалении категории")}catch(e){console.error("Ошибка при удалении категории:",e)}},G=(e,t)=>{e["categories-name"]!=="Все"&&(v.value=e,P.value=!0)},I=()=>{x.value=!1,h.value=""},T=()=>{P.value=!1,v.value=null};_(()=>{S()});const H=async()=>{try{await w.post(`${u}/api/admins/logout`,{},{withCredentials:!0}),window.location.href="/admin"}catch(e){console.error("Ошибка при выходе из системы",e)}};return(e,t)=>{const n=Z;return c(),i(C,null,[o("button",{onClick:H,class:"logout-class"},"Выйти"),o("div",re,[o("div",ie,[o("div",ce,[M(n,{to:"/admin/sAdmin/admin-product"},{default:q(()=>t[6]||(t[6]=[o("button",{class:"add-button"},"Добавить товар",-1)])),_:1}),o("button",{class:"add-button",onClick:t[0]||(t[0]=s=>x.value=!0)},"Добавить категорию")]),o("div",de,[V(o("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>f.value=s),type:"text",placeholder:"Поиск товаров...",class:"search-input search-sAdmin"},null,512),[[U,f.value]])]),o("div",ue,[o("div",ve,[(c(!0),i(C,null,D(z.value,(s,l)=>(c(),i("div",{class:"Сategory",key:l,onClick:p=>G(s),onMouseover:p=>$.value=l,onMouseleave:t[2]||(t[2]=p=>$.value=null),style:ae({border:$.value===l&&s["categories-name"]!=="Все"?"2px solid red":"none"})},[o("a",me,b(s["categories-name"]),1)],44,pe))),128))])])]),x.value?(c(),i("div",ge,[o("div",ye,[t[7]||(t[7]=o("h3",null,"Введите название категории:",-1)),V(o("input",{"onUpdate:modelValue":t[3]||(t[3]=s=>h.value=s),type:"text",placeholder:"Название категории",class:"modal-input-addCategory"},null,512),[[U,h.value]]),o("div",{class:"modal-buttons-addCategory"},[o("button",{class:"modal-button-addCategory add",onClick:J},"Добавить"),o("button",{class:"modal-button-addCategory cancel",onClick:I},"Отмена")])])])):A("",!0),P.value?(c(),i("div",he,[o("div",fe,[v.value?(c(),i("h3",_e,'Вы действительно хотите удалить категорию: "'+b(v.value["categories-name"])+'"?',1)):A("",!0),o("div",{class:"modal-buttons-deleteCategory"},[o("button",{class:"modal-button-deleteCategory delete",onClick:Q},"Удалить"),o("button",{class:"modal-button-deleteCategory cancel",onClick:T},"Отмена")])])])):A("",!0)]),o("div",Ce,[o("div",be,[(c(!0),i(C,null,D(g.value,s=>(c(),i("div",{key:s,class:ne(["page",{active:a.value===s-1}])},[o("div",we,[(c(!0),i(C,null,D(X(s-1),(l,p)=>(c(),i("div",{class:"item",key:p},[o("div",ke,[M(n,{to:`/admin/sAdmin/admin-product/${l._id}`},{default:q(()=>[o("img",{src:l["product-image"],style:{width:"100%",height:"100%"}},null,8,xe)]),_:2},1032,["to"])]),o("div",Pe,b(l["product-name"]),1),o("div",$e,[le(b(j(l["product-price"]))+" р",1),t[8]||(t[8]=o("p",{class:"quantity"},"/1шт",-1))]),o("div",Se,[M(n,{to:`/admin/sAdmin/admin-product/${l._id}`},{default:q(()=>t[9]||(t[9]=[o("button",{class:"ProductBtn"},"Изменить товар",-1)])),_:2},1032,["to"])])]))),128))])],2))),128))]),o("div",Ae,[o("button",{class:"nav-btn prev",onClick:t[4]||(t[4]=s=>L("prev"))},"<"),o("input",{class:"page-input",type:"number",value:a.value+1,onInput:N,onKeyup:se(N,["enter"]),min:"1",max:g.value},null,40,Me),o("button",{class:"nav-btn next",onClick:t[5]||(t[5]=s=>L("next"))},">")])])],64)}}});export{ze as default};
