import{g as z,r as i,n as O,A as I,c as d,a as t,k as N,l as D,v as E,F as C,q as P,j as x,t as n,d as b,p as R,o as u,D as X}from"./a-2ymmio.js";import{a as m}from"./BtuGy7By.js";import"./BbCOxZKf.js";import"./_d1bhYXs.js";const G={class:"div-body-yAdmin"},H={class:"container-order"},J={class:"search-box"},K={class:"order-list"},Y=["onClick"],Z={class:"order-info"},ee={class:"field-value order-number"},te={class:"field-value order-gmail"},se={class:"field-value phone"},oe={class:"modal-actions"},le={class:"notification-container"},ae={class:"SliderModal"},re={class:"SlidesModal"},ne={class:"PageModal ActiveModal"},ie={class:"ContainerModal"},de={class:"ProductImageModal"},ue=["src"],ce={class:"InfoProductModal"},ve={class:"ProductNameModal"},me={class:"ProductOneOrderModalBox"},pe={class:"hsixstyle"},fe={class:"QuantityProductModal"},he=["onClick"],ye=["id","value","onInput"],_e=["onClick"],ge={class:"ProductSumPrice"},ke={id:"hfivestyle"},Ce={class:"DeliteProductModal"},be=["onClick"],we={key:0,class:"modal-info"},Me={class:"modal-actions"},De=z({__name:"index",setup($e){const g=i([]),p=i([]),w=i(!1),a=i(null),f=i(""),y=i(""),h=i(!1),v=i(null);i(!1),i("");let S=0;const q=s=>{const e=S++;g.value.unshift({message:s,id:e}),setTimeout(()=>{g.value=g.value.filter(o=>o.id!==e)},3e3)},M=s=>new Intl.NumberFormat("ru-RU",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(s).replace(/\s/g,".");O(async()=>{try{const s=await m.get("http://localhost:5000/api/admins/check-auth",{withCredentials:!0});console.log("Ответ от сервера при проверке авторизации",s.data),(!s.data.success||s.data.role!=="yAdmin")&&(window.location.href="/admin")}catch(s){console.error("Ошибка при проверке авторизации",s),window.location.href="/admin"}});const B=async()=>{try{await m.post("http://localhost:5000/api/admins/logout",{},{withCredentials:!0}),window.location.href="/admin"}catch(s){console.error("Ошибка при выходе из системы",s)}},A=s=>{v.value=s,h.value=!0};O(async()=>{try{const s=await m.get("http://localhost:5000/api/orders");p.value=s.data}catch(s){console.error("Ошибка при загрузке заказов:",s)}});const F=I(()=>{let s=p.value;if(f.value){const e=f.value.toLowerCase();if(e.startsWith("#")){const o=e.slice(1);s=s.filter(r=>r.orderNumber.toString().includes(o))}else s=s.filter(o=>o.orderNumber.toString().includes(e)||o["order-gmail"].toLowerCase().includes(e)||o["order-phone"].toLowerCase().includes(e))}return s.sort((e,o)=>e["order-status"]==="Не готов"&&o["order-status"]!=="Не готов"?-1:e["order-status"]!=="Не готов"&&o["order-status"]==="Не готов"?1:e["order-status"]==="Готов"&&o["order-status"]==="Готов"?o.orderNumber-e.orderNumber:0)}),Q=s=>{a.value=s,y.value=s["order-status"],w.value=!0},k=()=>{w.value=!1,a.value=null,y.value=""},L=async()=>{if(v.value)try{await m.delete(`http://localhost:5000/api/orders/${v.value._id}`),p.value=p.value.filter(s=>{var e;return s._id!==((e=v.value)==null?void 0:e._id)}),q(`Был удален заказ #${v.value.orderNumber}`),h.value=!1,v.value=null,k()}catch(s){console.error("Ошибка при удалении заказа:",s)}},V=async s=>{if(a.value){a.value.items.splice(s,1);try{await m.put(`http://localhost:5000/api/orders/${a.value._id}`,{items:a.value.items})}catch(e){console.error("Ошибка при удалении товара из заказа:",e)}}},T=async()=>{if(a.value)try{a.value["order-status"]=y.value,await m.put(`http://localhost:5000/api/orders/${a.value._id}`,{"order-status":a.value["order-status"],items:a.value.items}),p.value=p.value.map(s=>{var e;return s._id===((e=a.value)==null?void 0:e._id)?{...s,"order-status":a.value["order-status"]}:s}),k()}catch(s){console.error("Ошибка при сохранении изменений в заказе:",s)}},$=async(s,e)=>{if(a.value){e<1&&(e=1),a.value.items[s]["items-quantity"]=e;try{await m.put(`http://localhost:5000/api/orders/${a.value._id}`,{items:a.value.items})}catch(o){console.error("Ошибка при обновлении количества товара:",o)}}},U=I(()=>a.value?a.value.items.reduce((s,e)=>s+e["items-price"]*e["items-quantity"],0):0),W=s=>{if(s.startsWith("+")){const o=s.replace(/[^\d+]/g,"").match(/^\+(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);if(o){let r="+";return o[1]&&(r+=`${o[1]}`),o[2]&&(r+=` (${o[2]}`),o[3]&&(r+=`) ${o[3]}`),o[4]&&(r+=`-${o[4]}`),o[5]&&(r+=`-${o[5]}`),r}}return s},j=s=>{const e=s.target,o=e.value;if(o.startsWith("+")){const r=W(o);e.value=r,f.value=r}else f.value=o};return(s,e)=>{var o,r;return u(),d(C,null,[t("button",{onClick:B,class:"logout-class"},"Выйти"),t("div",G,[t("div",H,[t("div",J,[D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>f.value=l),type:"text",placeholder:"Поиск по номеру заказа, почте или телефону",class:"search-input",onInput:j},null,544),[[E,f.value]])]),t("div",K,[(u(!0),d(C,null,P(F.value,(l,c)=>(u(),d("div",{key:c,class:"order-item",onClick:_=>Q(l)},[t("div",Z,[t("span",ee,"#"+n(l.orderNumber),1),t("span",te,n(l["order-gmail"]),1),t("span",se,n(l["order-phone"]),1),t("span",{class:X(["status",{ready:l["order-status"]==="Готов","not-ready":l["order-status"]==="Не готов"}])},n(l["order-status"]),3)])],8,Y))),128))]),h.value?(u(),d("div",{key:0,class:"modal-overlay-delete",onClick:e[4]||(e[4]=l=>h.value=!1)},[t("div",{class:"modal-content-delete",onClick:e[3]||(e[3]=x(()=>{},["stop"]))},[t("span",{class:"close-yAdmin",onClick:e[1]||(e[1]=l=>h.value=!1)},"×"),t("h2",null,"Вы действительно хотите удалить заказ #"+n((o=v.value)==null?void 0:o.orderNumber)+"?",1),t("div",oe,[t("button",{onClick:L,class:"btn-delete"},"Удалить"),t("button",{onClick:e[2]||(e[2]=l=>h.value=!1),class:"btn-cancel"},"Отмена")])])])):N("",!0),t("div",le,[(u(!0),d(C,null,P(g.value,l=>(u(),d("div",{key:l.id,class:"notification"},n(l.message),1))),128))]),w.value?(u(),d("div",{key:1,class:"modal-overlay",onClick:k},[t("div",{class:"modal-content",onClick:e[7]||(e[7]=x(()=>{},["stop"]))},[t("span",{class:"close-yAdmin",onClick:k},"×"),e[15]||(e[15]=t("h2",{style:{"text-align":"left"}},"Информация о заказе:",-1)),t("div",ae,[t("div",re,[t("div",ne,[t("div",ie,[(u(!0),d(C,null,P((r=a.value)==null?void 0:r.items,(l,c)=>(u(),d("div",{key:c,class:"itemModal"},[t("div",de,[t("img",{src:l["items-product-image"],style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,ue)]),t("div",ce,[t("h4",ve,n(l["items-product-name"]),1),e[8]||(e[8]=t("div",{class:"ProductSizeModalBox"},[t("h5",{class:"hsixstyle"},"ОБЪЕМ: 500мл")],-1)),t("div",me,[t("h5",pe,n(M(l["items-price"]))+" р./шт",1)]),t("div",fe,[t("button",{onClick:_=>$(c,l["items-quantity"]-1),class:"BtnsQuantity"},"-",8,he),t("input",{type:"number",id:`quantity${c}`,class:"quantitystye",value:l["items-quantity"],onInput:_=>$(c,parseInt(_.target.value)),min:"1"},null,40,ye),t("button",{onClick:_=>$(c,l["items-quantity"]+1),class:"BtnsQuantity Plus"},"+",8,_e)])]),t("div",ge,[t("h4",ke,n(M(l["items-price"]*l["items-quantity"]))+" /Руб.",1)]),t("div",Ce,[t("button",{onClick:_=>V(c),class:"BtnsDeliteProductModal"},"X",8,be)])]))),128))])])])]),a.value?(u(),d("div",we,[t("p",null,[e[9]||(e[9]=t("strong",null,"Имя:",-1)),b(" "+n(a.value["order-name"]),1)]),t("p",null,[e[10]||(e[10]=t("strong",null,"Почта:",-1)),b(" "+n(a.value["order-gmail"]),1)]),t("p",null,[e[11]||(e[11]=t("strong",null,"Телефон:",-1)),b(" "+n(a.value["order-phone"]),1)]),t("p",null,[e[13]||(e[13]=t("strong",null,"Статус:",-1)),D(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>y.value=l)},e[12]||(e[12]=[t("option",{value:"Не готов"},"Не готов",-1),t("option",{value:"Готов"},"Готов",-1)]),512),[[R,y.value]])]),t("p",null,[e[14]||(e[14]=t("strong",null,"Сумма:",-1)),b(" "+n(M(U.value))+" р.",1)])])):N("",!0),t("div",Me,[t("button",{onClick:T,class:"btn-save"},"Сохранить изменения"),t("button",{onClick:e[6]||(e[6]=l=>A(a.value)),class:"btn-delete"},"Удалить заказ")])])])):N("",!0)])])],64)}}});export{De as default};
