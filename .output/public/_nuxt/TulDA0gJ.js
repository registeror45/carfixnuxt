import{_ as N}from"./VLZ1h-JR.js";import{g as U,j,r as i,p as y,c as h,a,b as E,w as L,l as T,t as C,m as x,v as R,q as M,F as S,s as O,y as F,o as w}from"./CtCbi2K0.js";import{a as $}from"./BtuGy7By.js";import"./BbCOxZKf.js";import"./_d1bhYXs.js";const G={class:"GoBackBody"},q={class:"PageProductBody"},J={class:"PageProductContent"},z={class:"PageImageProduct"},H={for:"imageUpload",class:"PageBtnProductAdd",style:{cursor:"pointer"}},K=["src"],Q={class:"PageProductRightBlock"},W={class:"PageProductText"},X={class:"PageVolumeSelection"},Y=["value"],Z={class:"PageProductDescriptionBlock"},le=U({__name:"index",setup(ee){const{public:{apiBaseUrl:P}}=j(),l=i(null),d=i(""),g=i(null),p=i(""),k=i([]),m=i(""),r=i(null);y(()=>{if(r.value){const s=e=>{e=e.replace(/[^\d,]/g,"");const[o,t=""]=e.split(","),n=o.replace(/\B(?=(\d{3})+(?!\d))/g,"."),c=t.slice(0,2).padEnd(2,"0");return n+","+c};r.value.addEventListener("input",e=>{const o=e.target,t=o.selectionStart;let n=o.value;if(n.indexOf(",")===-1&&o.value.indexOf(",")!==-1&&t!==null){n=n.slice(0,t)+","+n.slice(t),o.value=n;const f=Math.max(t-1,0);o.setSelectionRange(f,f);return}const u=s(n);o.value=u;const D=u.replace(/\./g,"").replace(",",".");if(g.value=parseFloat(D)||null,t!==null){const f=u.slice(0,t).split("").filter(_=>_===".").length,I=n.slice(0,t).split("").filter(_=>_===".").length;let v=t+(f-I);const B=u.indexOf(",");B!==-1&&v>B&&(v=Math.min(v,u.length)),o.setSelectionRange(v,v)}u===",00"&&o.setSelectionRange(0,0)}),r.value.addEventListener("focus",()=>{setTimeout(()=>{var o,t;(((o=r.value)==null?void 0:o.value)||"")===",00"&&((t=r.value)==null||t.setSelectionRange(0,0))},10)}),r.value.value=",00"}}),y(async()=>{try{const s=await $.get(`${P}/api/admins/check-auth`,{withCredentials:!0});console.log("Ответ от сервера при проверке авторизации",s.data),(!s.data.success||s.data.role!=="sAdmin")&&(window.location.href="/admin")}catch(s){console.error("Ошибка при проверке авторизации",s),window.location.href="/admin"}});const b=s=>{var t;const o=(t=s.target.files)==null?void 0:t[0];if(o){const n=new FileReader;n.onload=c=>{c.target&&c.target.result&&(l.value=c.target.result)},n.readAsDataURL(o)}},A=async()=>{try{const s=await fetch(`${P}/api/categories`);if(!s.ok)throw new Error("Ошибка при получении категорий");const e=await s.json();k.value=e.filter(o=>o["categories-name"]!=="Все")}catch(s){console.error("Ошибка:",s)}},V=async()=>{if(!d.value||g.value===null||!p.value||!m.value||!l.value){alert("Все поля обязательны для заполнения");return}const s=g.value,e={"product-name":d.value,"product-description":p.value,"product-price":s,"product-image":l.value,"product-category":m.value};console.log("Отправляемые данные:",e);try{const o=await fetch(`${P}/api/products`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)});if(!o.ok){const n=await o.json();throw console.error("Ошибка сервера:",n),new Error("Ошибка при сохранении товара")}const t=await o.json();d.value="",g.value=null,p.value="",m.value="",l.value=null}catch(o){console.error("Ошибка:",o),alert("Ошибка при сохранении товара")}F("/admin/sAdmin")};return y(()=>{A()}),(s,e)=>{const o=N;return w(),h(S,null,[e[5]||(e[5]=a("meta",{charset:"utf-8"},null,-1)),e[6]||(e[6]=a("meta",{name:"viewport",content:"width=device-width, initial-scale=1"},null,-1)),e[7]||(e[7]=a("title",null,"Создание товара",-1)),e[8]||(e[8]=a("link",{rel:"icon",href:"@/image/IcoL.ico",type:"image/x-icon"},null,-1)),a("div",G,[E(o,{to:"/admin/sAdmin"},{default:L(()=>e[3]||(e[3]=[a("a",{class:"BtnGoBack"},"<- назад",-1)])),_:1})]),a("div",q,[a("div",J,[a("div",z,[a("input",{type:"file",accept:"image/*",onChange:b,style:{display:"none"},id:"imageUpload"},null,32),a("label",H,C(l.value?"Изменить изображение":"Загрузить изображение"),1),l.value?(w(),h("img",{key:0,src:l.value,style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,K)):T("",!0)]),a("div",Q,[a("div",W,[x(a("input",{"onUpdate:modelValue":e[0]||(e[0]=t=>d.value=t),placeholder:"Введите название товара",class:"custom-input"},null,512),[[R,d.value]]),a("input",{ref_key:"priceInputRef",ref:r,placeholder:"Введите цену товара",class:"custom-input"},null,512),a("div",X,[x(a("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>m.value=t),class:"custom-select"},[e[4]||(e[4]=a("option",{value:"",disabled:"",selected:""},"Выберите категорию товара",-1)),(w(!0),h(S,null,O(k.value,t=>(w(),h("option",{key:t._id,value:t._id},C(t["categories-name"]),9,Y))),128))],512),[[M,m.value]])]),a("div",{class:"PageButtonProductAdd"},[a("button",{class:"PageAdminBtnProductAdd",onClick:V},"Сохранить")])]),a("div",Z,[x(a("textarea",{"onUpdate:modelValue":e[2]||(e[2]=t=>p.value=t),placeholder:"Введите описание товара",class:"custom-textarea"},null,512),[[R,p.value]])])])])])],64)}}});export{le as default};
