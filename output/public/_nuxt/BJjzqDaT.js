import{g as R,j as z,r as i,p as I,B,c as u,a as t,l as P,m as D,v as X,F as b,s as O,k as q,t as n,d as $,q as G,o as d,E as H}from"./CtCbi2K0.js";import{a as p}from"./BtuGy7By.js";import"./BbCOxZKf.js";import"./_d1bhYXs.js";const J={class:"div-body-yAdmin"},K={class:"container-order"},Y={class:"search-box"},Z={class:"order-list"},ee=["onClick"],te={class:"order-info"},se={class:"field-value order-number"},oe={class:"field-value order-gmail"},le={class:"field-value phone"},ae={class:"modal-actions"},re={class:"notification-container"},ne={class:"SliderModal"},ie={class:"SlidesModal"},ue={class:"PageModal ActiveModal"},de={class:"ContainerModal"},ce={class:"ProductImageModal"},ve=["src"],me={class:"InfoProductModal"},pe={class:"ProductNameModal"},fe={class:"ProductOneOrderModalBox"},ye={class:"hsixstyle"},_e={class:"QuantityProductModal"},he=["onClick"],ge=["id","value","onInput"],Ce=["onClick"],ke={class:"ProductSumPrice"},be={id:"hfivestyle"},$e={class:"DeliteProductModal"},we=["onClick"],Me={key:0,class:"modal-info"},Ne={class:"modal-actions"},qe=R({__name:"index",setup(Pe){const{public:{apiBaseUrl:v}}=z(),C=i([]),f=i([]),w=i(!1),a=i(null),y=i(""),h=i(""),_=i(!1),m=i(null);i(!1),i("");let S=0;const x=s=>{const e=S++;C.value.unshift({message:s,id:e}),setTimeout(()=>{C.value=C.value.filter(o=>o.id!==e)},3e3)},M=s=>new Intl.NumberFormat("ru-RU",{style:"decimal",minimumFractionDigits:2,maximumFractionDigits:2}).format(s).replace(/\s/g,".");I(async()=>{try{const s=await p.get(`${v}/api/admins/check-auth`,{withCredentials:!0});console.log("Ответ от сервера при проверке авторизации",s.data),(!s.data.success||s.data.role!=="yAdmin")&&(window.location.href="/admin")}catch(s){console.error("Ошибка при проверке авторизации",s),window.location.href="/admin"}});const F=async()=>{try{await p.post(`${v}/api/admins/logout`,{},{withCredentials:!0}),window.location.href="/admin"}catch(s){console.error("Ошибка при выходе из системы",s)}},Q=s=>{m.value=s,_.value=!0};I(async()=>{try{const s=await p.get(`${v}/api/orders`);f.value=s.data}catch(s){console.error("Ошибка при загрузке заказов:",s)}});const A=B(()=>{let s=f.value;if(y.value){const e=y.value.toLowerCase();if(e.startsWith("#")){const o=e.slice(1);s=s.filter(r=>r.orderNumber.toString().includes(o))}else s=s.filter(o=>o.orderNumber.toString().includes(e)||o["order-gmail"].toLowerCase().includes(e)||o["order-phone"].toLowerCase().includes(e))}return s.sort((e,o)=>e["order-status"]==="Не готов"&&o["order-status"]!=="Не готов"?-1:e["order-status"]!=="Не готов"&&o["order-status"]==="Не готов"?1:e["order-status"]==="Готов"&&o["order-status"]==="Готов"?o.orderNumber-e.orderNumber:0)}),L=s=>{a.value=s,h.value=s["order-status"],w.value=!0},k=()=>{w.value=!1,a.value=null,h.value=""},V=async()=>{if(m.value)try{await p.delete(`${v}/api/orders/${m.value._id}`),f.value=f.value.filter(s=>{var e;return s._id!==((e=m.value)==null?void 0:e._id)}),x(`Был удален заказ #${m.value.orderNumber}`),_.value=!1,m.value=null,k()}catch(s){console.error("Ошибка при удалении заказа:",s)}},T=async s=>{if(a.value){a.value.items.splice(s,1);try{await p.put(`${v}/api/orders/${a.value._id}`,{items:a.value.items})}catch(e){console.error("Ошибка при удалении товара из заказа:",e)}}},U=async()=>{if(a.value)try{a.value["order-status"]=h.value,await p.put(`${v}/api/orders/${a.value._id}`,{"order-status":a.value["order-status"],items:a.value.items}),f.value=f.value.map(s=>{var e;return s._id===((e=a.value)==null?void 0:e._id)?{...s,"order-status":a.value["order-status"]}:s}),k()}catch(s){console.error("Ошибка при сохранении изменений в заказе:",s)}},N=async(s,e)=>{if(a.value){e<1&&(e=1),a.value.items[s]["items-quantity"]=e;try{await p.put(`${v}/api/orders/${a.value._id}`,{items:a.value.items})}catch(o){console.error("Ошибка при обновлении количества товара:",o)}}},W=B(()=>a.value?a.value.items.reduce((s,e)=>s+e["items-price"]*e["items-quantity"],0):0),j=s=>{if(s.startsWith("+")){const o=s.replace(/[^\d+]/g,"").match(/^\+(\d{0,1})(\d{0,3})(\d{0,3})(\d{0,2})(\d{0,2})/);if(o){let r="+";return o[1]&&(r+=`${o[1]}`),o[2]&&(r+=` (${o[2]}`),o[3]&&(r+=`) ${o[3]}`),o[4]&&(r+=`-${o[4]}`),o[5]&&(r+=`-${o[5]}`),r}}return s},E=s=>{const e=s.target,o=e.value;if(o.startsWith("+")){const r=j(o);e.value=r,y.value=r}else y.value=o};return(s,e)=>{var o,r;return d(),u(b,null,[t("button",{onClick:F,class:"logout-class"},"Выйти"),t("div",J,[t("div",K,[t("div",Y,[D(t("input",{"onUpdate:modelValue":e[0]||(e[0]=l=>y.value=l),type:"text",placeholder:"Поиск по номеру заказа, почте или телефону",class:"search-input",onInput:E},null,544),[[X,y.value]])]),t("div",Z,[(d(!0),u(b,null,O(A.value,(l,c)=>(d(),u("div",{key:c,class:"order-item",onClick:g=>L(l)},[t("div",te,[t("span",se,"#"+n(l.orderNumber),1),t("span",oe,n(l["order-gmail"]),1),t("span",le,n(l["order-phone"]),1),t("span",{class:H(["status",{ready:l["order-status"]==="Готов","not-ready":l["order-status"]==="Не готов"}])},n(l["order-status"]),3)])],8,ee))),128))]),_.value?(d(),u("div",{key:0,class:"modal-overlay-delete",onClick:e[4]||(e[4]=l=>_.value=!1)},[t("div",{class:"modal-content-delete",onClick:e[3]||(e[3]=q(()=>{},["stop"]))},[t("span",{class:"close-yAdmin",onClick:e[1]||(e[1]=l=>_.value=!1)},"×"),t("h2",null,"Вы действительно хотите удалить заказ #"+n((o=m.value)==null?void 0:o.orderNumber)+"?",1),t("div",ae,[t("button",{onClick:V,class:"btn-delete"},"Удалить"),t("button",{onClick:e[2]||(e[2]=l=>_.value=!1),class:"btn-cancel"},"Отмена")])])])):P("",!0),t("div",re,[(d(!0),u(b,null,O(C.value,l=>(d(),u("div",{key:l.id,class:"notification"},n(l.message),1))),128))]),w.value?(d(),u("div",{key:1,class:"modal-overlay",onClick:k},[t("div",{class:"modal-content",onClick:e[7]||(e[7]=q(()=>{},["stop"]))},[t("span",{class:"close-yAdmin",onClick:k},"×"),e[14]||(e[14]=t("h2",{style:{"text-align":"left"}},"Информация о заказе:",-1)),t("div",ne,[t("div",ie,[t("div",ue,[t("div",de,[(d(!0),u(b,null,O((r=a.value)==null?void 0:r.items,(l,c)=>(d(),u("div",{key:c,class:"itemModal"},[t("div",ce,[t("img",{src:l["items-product-image"],style:{width:"100%",height:"100%","object-fit":"cover"}},null,8,ve)]),t("div",me,[t("h4",pe,n(l["items-product-name"]),1),t("div",fe,[t("h5",ye,n(M(l["items-price"]))+" р./шт",1)]),t("div",_e,[t("button",{onClick:g=>N(c,l["items-quantity"]-1),class:"BtnsQuantity"},"-",8,he),t("input",{type:"number",id:`quantity${c}`,class:"quantitystye",value:l["items-quantity"],onInput:g=>N(c,parseInt(g.target.value)),min:"1"},null,40,ge),t("button",{onClick:g=>N(c,l["items-quantity"]+1),class:"BtnsQuantity Plus"},"+",8,Ce)])]),t("div",ke,[t("h4",be,n(M(l["items-price"]*l["items-quantity"]))+" /Руб.",1)]),t("div",$e,[t("button",{onClick:g=>T(c),class:"BtnsDeliteProductModal"},"X",8,we)])]))),128))])])])]),a.value?(d(),u("div",Me,[t("p",null,[e[8]||(e[8]=t("strong",null,"Имя:",-1)),$(" "+n(a.value["order-name"]),1)]),t("p",null,[e[9]||(e[9]=t("strong",null,"Почта:",-1)),$(" "+n(a.value["order-gmail"]),1)]),t("p",null,[e[10]||(e[10]=t("strong",null,"Телефон:",-1)),$(" "+n(a.value["order-phone"]),1)]),t("p",null,[e[12]||(e[12]=t("strong",null,"Статус:",-1)),D(t("select",{"onUpdate:modelValue":e[5]||(e[5]=l=>h.value=l)},e[11]||(e[11]=[t("option",{value:"Не готов"},"Не готов",-1),t("option",{value:"Готов"},"Готов",-1)]),512),[[G,h.value]])]),t("p",null,[e[13]||(e[13]=t("strong",null,"Сумма:",-1)),$(" "+n(M(W.value))+" р.",1)])])):P("",!0),t("div",Ne,[t("button",{onClick:U,class:"btn-save"},"Сохранить изменения"),t("button",{onClick:e[6]||(e[6]=l=>Q(a.value)),class:"btn-delete"},"Удалить заказ")])])])):P("",!0)])])],64)}}});export{qe as default};
